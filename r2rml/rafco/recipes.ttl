@base <http://rafco.jgsogo.es/def/rafco.ttl#>.

@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rafco: <http://rafco.jgsogo.es/linkeddata/recurso/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix time: <http://www.w3.org/TR/owl-time#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.

@prefix list: <http://www.ontologydesignpatterns.org/cp/owl/list.owl#>.

#########
# Recipes
#########
base:ingredient
    # Ingredients -- Food
    #   Meto todos los de la tabla foods, es cierto que no todos ellos se utilizarán en
    #   las recetas, pero no sé cómo discriminarlos en esta importación.
    rr:logicalTable [ rr:tableName '"food_food"'; ];
    rr:subjectMap [
        rr:template rafco:ingredient/{"NDB_no"};
        rr:class base:Ingredient;
        ].

base:ingredient-isProduced
    # Recipe
    rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
    rr:subjectMap [ 
        rr:template rafco:ingredient/{"Produces_id"};
        ];
    rr:predicateObjectMap [
        rr:predicate base:isProduced;
        rr:objectMap [rr:template rafco:recipe/{"id"};];
        ].

base:recipe
    # Recipe
    rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
    rr:subjectMap [ 
        rr:template rafco:recipe/{"id"};
        rr:class base:Recipe;
        ];
    rr:predicateObjectMap [
        rr:predicate base:produces;
        rr:objectMap [rr:template rafco:ingredient/{"Produces_id"};];
        ];
    rr:predicateObjectMap [
        rr:predicate base:hasTitle;
        rr:objectMap [rr:column "Title"];
        ];
    rr:predicateObjectMap [
        rr:predicate base:hasDescription;
        rr:objectMap [  rr:column "Description"];
        ];
    rr:predicateObjectMap [
        rr:predicate base:hasRating;
        rr:objectMap [  rr:column "Rating" ; 
                        rr:termType rr:Literal; ]; #! TODO: Esto es un float/double, pero no sé cómo ponerlo.
        ];
     rr:predicateObjectMap [
         rr:predicate base:recipeYields;
         rr:objectMap [  rr:column "Yields"];
         ];
     # CookTime
     rr:predicateObjectMap [
         rr:predicate base:cookTime;
         rr:objectMap [  rr:template rafco:recipe/{"id"}/cookTime/{"CookTime"} ]
         ];
     # PrepTime
     rr:predicateObjectMap [
         rr:predicate base:prepTime;
         rr:objectMap [  rr:template rafco:recipe/{"id"}/prepTime/{"PrepTime"} ]
         ];
     # URL
     rr:predicateObjectMap [
         rr:predicate base:seeAlso;
         rr:objectMap [  rr:column '{"URL"}'];
         ];
     # Image
     rr:predicateObjectMap [
         rr:predicate base:hasImage;
         rr:objectMap [  rr:template '{"Image"}'];
         ];
     # Author
     rr:predicateObjectMap [
         rr:predicate base:hasAuthor; #! TODO: Cambiar por foaf:isAuthor o schema:isAuthor (buscar)
         rr:objectMap [  rr:template rafco:author/{"Author"}];
         ];
     # List
     rr:predicateObjectMap [
         rr:predicate base:hasInstructions; 
         rr:objectMap [  rr:template rafco:recipe/{"id"}/Instructions'];
         ].

 base:recipe-cooktime
     rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
     rr:subjectMap [ 
         rr:template rafco:recipe/{"id"}/cookTime/{"CookTime"};
         rr:class time:DurationDescription;
         ];
     rr:predicateObjectMap [
         rr:predicate time:minutes;
         rr:objectMap [  rr:column "CookTime"];
         ].

 base:recipe-preptime
     rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
     rr:subjectMap [ 
         rr:template rafco:recipe/{"id"}/prepTime/{"PrepTime"};
         rr:class time:DurationDescription;
         ];
     rr:predicateObjectMap [
         rr:predicate time:minutes;
         rr:objectMap [  rr:column "PrepTime"];
         ].

base:recipe-url
    rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
    rr:subjectMap [ 
        rr:template '{"URL"}';
        rr:class foaf:Document;
        ].

base:recipe-image
    rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
    rr:subjectMap [ 
        rr:template '{"Image"}';
        rr:class foaf:Image;
        ].

base:recipe-author
    rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
    rr:subjectMap [ 
        rr:template rafco:author/{"Author"};
        rr:class foaf:Person;
        ].

base:recipe-instructions
    rr:logicalTable [ rr:tableName '"recipes_recipe"'; ];
    rr:subjectMap [ 
        rr:template rafco:recipe/{"id"}/Instructions';
        rr:class list:List;
        ].

############
# Directions
############
base:directions
    rr:logicalTable [ rr:tableName '"recipes_direction"'; ];
    rr:subjectMap [ 
        rr:template rafco:direction/{"id"};
        rr:class list:ListItem;
        ];
    rr:predicateObjectMap [
        rr:predicate base:hasText;
        rr:objectMap [  rr:column "Description"];
        ].
    #! TODO: Realmente no sé cómo poner el firstItem, lastItem, nextItem,...


######################
# IngredientWithAmount
######################
base:recipe-ingredient-with-amount
    rr:logicalTable [ rr:tableName '"recipes_ingredientwithamount"'; ];
    rr:subjectMap [ 
        rr:template rafco:recipe/{"Recipe_id"};        
        ];
    rr:predicateObjectMap [
        rr:predicate base:hasIngredientWithAmount;
        rr:objectMap [  rr:template rafco:ingredientwithamount/{"id"}];
        ].

base:ingredient-with-amount
    rr:logicalTable [ rr:tableName '"recipes_ingredientwithamount"'; ];
    rr:subjectMap [ 
        rr:template rafco:ingredientwithamount/{"id"};
        rr:class base:IngredientWithAmount;
        ];
    rr:predicateObjectMap [
        rr:predicate base:hasIngredient;
        rr:objectMap [  rr:template rafco:ingredient/{"Ingredient_id"}];
        ];
    rr:predicateObjectMap [
        rr:predicate base:value;
        rr:objectMap [  rr:column "Quantity";
                        rr:termType rr:Literal;];
        ];
    rr:predicateObjectMap [
        rr:predicate base:unit;
        rr:objectMap [  rr:template 'http://qudt.org/vocab/unit/{"Units"}';];
        ];
    rr:predicateObjectMap [
        rr:predicate rdf:label;
        rr:objectMap [  rr:column "HumanReadable";];
        ].
